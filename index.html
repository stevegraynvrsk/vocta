import React, { useEffect, useState, useRef, useMemo } from 'react';
import { Bot, Zap, BrainCircuit, Clock, ShieldCheck, CheckCircle2, ChevronRight, Activity, Network, Fingerprint, Sparkles, Loader2, Play, Pause, Volume2, ChevronUp, MessageSquare } from 'lucide-react';

const GlassCard = ({ children, className = "", style = {} }) => (
  <div 
    className={`bg-white/20 backdrop-blur-xl border border-white/50 shadow-[0_8px_32px_rgba(0,0,0,0.03)] ${className}`}
    style={style}
  >
    {children}
  </div>
);

const GlassButton = ({ children, className = "", onClick }) => (
  <button 
    onClick={onClick}
    className={`px-8 py-4 rounded-full bg-white/20 backdrop-blur-xl border border-white/60 hover:bg-white/40 transition-all duration-300 shadow-[0_4px_20px_rgba(0,0,0,0.04)] text-sm tracking-widest uppercase font-medium text-slate-700 hover:text-slate-900 flex items-center gap-2 ${className}`}
  >
    {children}
  </button>
);

// Компонент Аудиоплеера
const AudioPlayer = ({ src }) => {
  const [isPlaying, setIsPlaying] = useState(false);
  const [progress, setProgress] = useState(0);
  const audioRef = useRef(null);
  
  // Состояние для динамической волны
  const [waveform, setWaveform] = useState(Array.from({ length: 60 }).map(() => 15));

  // Анимация эквалайзера при проигрывании
  useEffect(() => {
    let interval;
    if (isPlaying) {
      interval = setInterval(() => {
        // Генерируем случайную высоту для каждого столбика (от 20% до 100%)
        setWaveform(Array.from({ length: 60 }).map(() => Math.random() * 80 + 20));
      }, 150); // Скорость обновления волны
    } else {
      // Спокойное состояние, когда на паузе (от 10% до 25%)
      setWaveform(Array.from({ length: 60 }).map(() => Math.random() * 15 + 10));
    }
    return () => clearInterval(interval);
  }, [isPlaying]);

  const togglePlay = () => {
    if (!audioRef.current) return;
    if (isPlaying) {
      audioRef.current.pause();
    } else {
      audioRef.current.play();
    }
    setIsPlaying(!isPlaying);
  };

  const handleTimeUpdate = () => {
    if (!audioRef.current) return;
    const current = audioRef.current.currentTime;
    const total = audioRef.current.duration || 1;
    setProgress((current / total) * 100);
  };

  const handleSeek = (e) => {
    if (!audioRef.current) return;
    const bounds = e.currentTarget.getBoundingClientRect();
    const percent = (e.clientX - bounds.left) / bounds.width;
    audioRef.current.currentTime = percent * audioRef.current.duration;
    setProgress(percent * 100);
  };

  return (
    <GlassCard className="w-full max-w-4xl p-6 md:p-8 rounded-[2.5rem] flex flex-col md:flex-row items-center gap-6 md:gap-8 mx-auto relative overflow-hidden group">
      {/* Декоративный светящийся фон, реагирующий на воспроизведение */}
      <div className={`absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full h-full bg-blue-300/10 blur-[60px] rounded-full transition-opacity duration-700 ${isPlaying ? 'opacity-100' : 'opacity-0'}`}></div>

      {/* Скрытый тег аудио */}
      {/* ВНИМАНИЕ: Замените src на ссылку вашего реального аудиофайла звонка */}
      <audio 
        ref={audioRef} 
        src={src || "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"} 
        onTimeUpdate={handleTimeUpdate}
        onEnded={() => setIsPlaying(false)}
      />

      {/* Кнопка Play/Pause */}
      <button 
        onClick={togglePlay}
        className="shrink-0 w-16 h-16 md:w-20 md:h-20 rounded-full bg-white/40 border border-white/80 flex items-center justify-center text-blue-500 hover:bg-white/60 hover:scale-105 transition-all shadow-[0_8px_30px_rgba(0,0,0,0.05)] z-10"
      >
        {isPlaying ? <Pause className="w-8 h-8 md:w-10 md:h-10 fill-current" /> : <Play className="w-8 h-8 md:w-10 md:h-10 fill-current ml-1" />}
      </button>

      {/* Центральная часть с визуализатором (на все пространство) */}
      <div className="flex-grow w-full flex items-center z-10 px-2 md:px-6">
        {/* Визуализатор звуковой волны */}
        <div 
          className="flex items-center justify-between w-full h-20 md:h-24 cursor-pointer group/wave" 
          onClick={handleSeek}
        >
          {waveform.map((h, i) => {
            const isActive = (i / waveform.length) * 100 <= progress;
            return (
              <div
                key={i}
                className={`w-1 md:w-[6px] rounded-full transition-all duration-150 ease-in-out ${
                  isActive 
                    ? 'bg-blue-500 shadow-[0_0_8px_rgba(59,130,246,0.6)]' 
                    : 'bg-blue-200/50 group-hover/wave:bg-blue-300/60'
                }`}
                style={{ height: `${h}%` }}
              />
            );
          })}
        </div>
      </div>
    </GlassCard>
  );
};

const App = () => {
  const [scrolled, setScrolled] = useState(false);
  const [showScrollTop, setShowScrollTop] = useState(false);

  // States для анимации появления "Анатомии"
  const anatomyRef = useRef(null);
  const [anatomyVisible, setAnatomyVisible] = useState(false);

  // States для анимации инфографики сравнения
  const comparisonRef = useRef(null);
  const [comparisonVisible, setComparisonVisible] = useState(false);

  // Gemini API States - ИИ Генератор сценариев
  const [niche, setNiche] = useState('');
  const [generatedScript, setGeneratedScript] = useState('');
  const [isScriptLoading, setIsScriptLoading] = useState(false);

  const apiKey = ""; // Ключ API предоставляется средой выполнения

  // Функция вызова Gemini API с экспоненциальной задержкой (Exponential Backoff)
  const callGeminiAPI = async (userText, systemText) => {
    const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
    const payload = {
      contents: [{ parts: [{ text: userText }] }],
      systemInstruction: { parts: [{ text: systemText }] }
    };

    const delays = [1000, 2000, 4000, 8000, 16000];
    for (let attempt = 0; attempt < 6; attempt++) {
      try {
        const response = await fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const data = await response.json();
        return data.candidates?.[0]?.content?.parts?.[0]?.text || "Извините, произошла ошибка при генерации ответа.";
      } catch (error) {
        if (attempt === 5) return "Ошибка подключения к ИИ. Пожалуйста, попробуйте позже.";
        await new Promise(resolve => setTimeout(resolve, delays[attempt]));
      }
    }
  };

  // Обработчик для генерации сценария диалога
  const handleGenerateScript = async () => {
    if (!niche.trim()) return;
    setIsScriptLoading(true);
    setGeneratedScript('');
    
    const prompt = `Напиши короткий, реалистичный пример диалога по телефону (на русском языке) между ИИ-ассистентом VOCTA и клиентом для бизнеса: ${niche}. 
    Диалог должен показывать, как круто VOCTA квалифицирует лида, отвечает на вопросы без скрипта и закрывает сделку/записывает на прием. 
    Формат: 
    Клиент: [реплика]
    VOCTA: [умный ответ ИИ]. 
    Максимум 4-5 обменов репликами. Без лишних вступлений.`;
    
    const systemInstruction = "Ты эксперт по продажам и копирайтер, создающий продающие сценарии для ИИ ассистентов.";
    
    const response = await callGeminiAPI(prompt, systemInstruction);
    setGeneratedScript(response);
    setIsScriptLoading(false);
  };

  // Логика отслеживания скролла для анимации мозга
  useEffect(() => {
    const observer = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting) {
          setAnatomyVisible(true);
        }
      },
      { threshold: 0.15 } // Запуск анимации, когда 15% блока появляется на экране (раньше было 0.3)
    );

    if (anatomyRef.current) {
      observer.observe(anatomyRef.current);
    }

    return () => {
      if (anatomyRef.current) observer.unobserve(anatomyRef.current);
    };
  }, []);

  // Логика отслеживания скролла для инфографики сравнения
  useEffect(() => {
    const observer = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting) {
          setComparisonVisible(true);
        }
      },
      { threshold: 0.15 } // Уменьшили порог срабатывания для раннего запуска
    );

    if (comparisonRef.current) {
      observer.observe(comparisonRef.current);
    }

    return () => {
      if (comparisonRef.current) observer.unobserve(comparisonRef.current);
    };
  }, []);

  useEffect(() => {
    const handleScroll = () => {
      setScrolled(window.scrollY > 50);
      setShowScrollTop(window.scrollY > 400); // Показываем кнопку после 400px прокрутки
    };
    window.addEventListener('scroll', handleScroll);
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  const scrollToSection = (id) => {
    const element = document.getElementById(id);
    if (element) {
      element.scrollIntoView({ behavior: 'smooth' });
    }
  };

  const scrollToTop = () => {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  };

  return (
    <div className="min-h-screen font-sans text-slate-800 font-light selection:bg-blue-100 selection:text-blue-900 bg-[#eef4f9] relative">
      
      {/* Main Hero Background (Coded visually to match your image exactly) */}
      <div className="absolute top-0 left-0 w-full h-[120vh] z-0 overflow-hidden pointer-events-none">
        {/* Sky gradient */}
        <div className="absolute inset-0 bg-gradient-to-b from-[#b5d3f5] via-[#d6e8fa] to-[#eef4f9]"></div>

        {/* Glowing Ring */}
        <div className="absolute top-[45%] left-1/2 -translate-x-1/2 -translate-y-1/2 w-[350px] h-[350px] md:w-[600px] md:h-[600px] rounded-full border-[3px] md:border-[4px] border-white shadow-[0_0_60px_rgba(255,255,255,0.8),inset_0_0_60px_rgba(255,255,255,0.8)] opacity-90 blur-[0.5px]"></div>

        {/* Ice Dunes (SVG Waves) */}
        <div className="absolute bottom-0 left-0 w-full h-[45vh]">
          <svg viewBox="0 0 1440 400" className="absolute bottom-0 w-full h-full drop-shadow-[0_-10px_20px_rgba(255,255,255,0.3)]" preserveAspectRatio="none" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill="rgba(255, 255, 255, 0.6)" d="M0,150L60,160C120,170,240,190,360,195C480,200,600,190,720,165C840,140,960,100,1080,95C1200,90,1320,120,1380,135L1440,150L1440,400L1380,400C1320,400,1200,400,1080,400C960,400,840,400,720,400C600,400,480,400,360,400C240,400,120,400,60,400L0,400Z"></path>
            <path fill="rgba(224, 238, 251, 0.9)" d="M0,220L80,210C160,200,320,180,480,185C640,190,800,220,960,235C1120,250,1280,250,1360,250L1440,250L1440,400L1360,400C1280,400,1120,400,960,400C800,400,640,400,480,400C320,400,160,400,80,400L0,400Z"></path>
            <path fill="#eef4f9" d="M0,300L120,280C240,260,480,220,720,215C960,210,1200,240,1320,255L1440,270L1440,400L1320,400C1200,400,960,400,720,400C480,400,240,400,120,400L0,400Z"></path>
          </svg>
        </div>
      </div>

      {/* HEADER */}
      <header className={`fixed top-0 left-0 right-0 z-50 transition-all duration-500 ${scrolled ? 'py-4 bg-[#eef4f9] border-b border-blue-200/50 shadow-md' : 'py-6 bg-transparent'}`}>
        <div className="max-w-7xl mx-auto px-6 flex justify-center items-center">
          <nav className="hidden md:flex items-center gap-10 text-sm tracking-wider text-slate-600">
            {['Что делает', 'Как это работает', 'Анатомия', 'Запуск', 'Преимущества'].map((item, idx) => (
              <button 
                key={idx} 
                onClick={() => scrollToSection(`section-${idx}`)}
                className="hover:text-blue-500 transition-colors duration-300 relative after:content-[''] after:absolute after:-bottom-1 after:left-0 after:w-0 after:h-[1px] after:bg-blue-400 hover:after:w-full after:transition-all after:duration-300"
              >
                {item}
              </button>
            ))}
          </nav>
          {/* Mobile menu hint */}
          <div className="md:hidden text-sm tracking-widest uppercase font-medium">VOCTA</div>
        </div>
      </header>

      <main className="pb-24 px-6 max-w-7xl mx-auto flex flex-col items-center overflow-hidden relative z-20">
        
        {/* 2. HERO SECTION */}
        <section className="w-full min-h-screen flex flex-col items-center justify-center text-center relative pt-20">
          <h1 className="text-7xl md:text-9xl font-extralight tracking-[0.15em] mb-6 text-slate-900 drop-shadow-md">
            VOCTA
          </h1>
          <p className="text-xl md:text-2xl font-light tracking-wide text-slate-800 max-w-2xl drop-shadow-sm">
            лучший сотрудник для твоего бизнеса
          </p>
          <div className="mt-16 animate-bounce opacity-60">
            <div className="w-[1px] h-20 bg-gradient-to-b from-transparent via-slate-500 to-transparent mx-auto"></div>
          </div>
        </section>

        {/* 3. WHAT IT DOES */}
        <section id="section-0" className="w-full pt-8 pb-20 scroll-mt-16">
          <h2 className="text-3xl md:text-4xl font-light text-center mb-16 tracking-wide">Что делает ваш новый сотрудник</h2>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6 w-full">
            <GlassCard className="p-10 rounded-[2rem] flex flex-col gap-4 group hover:bg-white/30 transition-all duration-500">
              <Zap strokeWidth={1} className="w-10 h-10 text-blue-400 mb-2 group-hover:scale-110 transition-transform duration-500" />
              <h3 className="text-xl font-medium tracking-wide">Моментально отвечает всем вашим клиентам</h3>
              <p className="text-slate-600 leading-relaxed font-light">Клиентам не нужно ждать, пока менеджер освободится.</p>
            </GlassCard>
            <GlassCard className="p-10 rounded-[2rem] flex flex-col gap-4 group hover:bg-white/30 transition-all duration-500">
              <CheckCircle2 strokeWidth={1} className="w-10 h-10 text-blue-400 mb-2 group-hover:scale-110 transition-transform duration-500" />
              <h3 className="text-xl font-medium tracking-wide">Квалифицирует вашу заявку</h3>
              <p className="text-slate-600 leading-relaxed font-light">Менеджер перезвонит уже с решением. А весь спам отметается, чтобы не тратить на него время.</p>
            </GlassCard>
            <GlassCard className="p-10 rounded-[2rem] flex flex-col gap-4 group hover:bg-white/30 transition-all duration-500">
              <BrainCircuit strokeWidth={1} className="w-10 h-10 text-blue-400 mb-2 group-hover:scale-110 transition-transform duration-500" />
              <h3 className="text-xl font-medium tracking-wide">Общается и рассуждает</h3>
              <p className="text-slate-600 leading-relaxed font-light">Отвечает на вопросы клиентов, понимая, о чем спрашивают его. Не использует скрипты, а думает и отвечает моментально.</p>
            </GlassCard>
            <GlassCard className="p-10 rounded-[2rem] flex flex-col gap-4 group hover:bg-white/30 transition-all duration-500">
              <Clock strokeWidth={1} className="w-10 h-10 text-blue-400 mb-2 group-hover:scale-110 transition-transform duration-500" />
              <h3 className="text-xl font-medium tracking-wide">Работает 24/7</h3>
              <p className="text-slate-600 leading-relaxed font-light">Все клиенты получат ответ вне зависимости от графика работы компании.</p>
            </GlassCard>
          </div>
        </section>

        {/* 3.5 AUDIO DEMO SECTION */}
        <section className="w-full pb-20 pt-8 flex flex-col items-center relative z-30">
          <h2 className="text-2xl md:text-3xl font-light text-center mb-4 tracking-wide text-slate-800">Кейс работы нейро-сотрудника</h2>
          <p className="text-center text-slate-600 font-light mb-10 max-w-2xl">
            Консультация клиента по вопросам экологической документации, квалификация ЛИДа, запись на консультацию.
          </p>
          {/* Сюда передается ссылка на ваш аудиофайл (сейчас стоит тестовый mp3) */}
          <AudioPlayer src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" />
        </section>

        {/* 4. HOW IT WORKS & INFOGRAPHIC */}
        {/* Перенесли ref={comparisonRef} сюда, в начало секции */}
        <section id="section-1" ref={comparisonRef} className="w-full pt-8 pb-20 scroll-mt-16">
          <h2 className="text-3xl md:text-4xl font-light text-center mb-16 tracking-wide">Как это работает?</h2>
          
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">
            
            {/* Text side - REDESIGNED */}
            <div className="flex flex-col gap-6 w-full">
              <GlassCard className={`p-6 md:p-8 rounded-[2rem] flex gap-5 items-start relative overflow-hidden group transition-all duration-1000 ease-out transform ${comparisonVisible ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-8'}`} style={{ transitionDelay: '100ms' }}>
                <div className="w-12 h-12 rounded-full bg-blue-100/50 flex items-center justify-center shrink-0 border border-blue-200/50 group-hover:scale-110 transition-transform duration-500">
                  <Zap className="w-5 h-5 text-blue-500" />
                </div>
                <div>
                  <h4 className="text-lg font-medium mb-2 text-slate-800 tracking-wide">Мгновенная реакция</h4>
                  <p className="text-slate-600 font-light text-sm md:text-base leading-relaxed">
                    Когда клиент звонит в вашу компанию, нейро-сотрудник <span className="font-medium text-slate-800">моментально отвечает</span> как живой человек и начинает вести клиента по диалогу. Клиенту не надо нажимать клавиши для выбора ответа, диктовать цель обращения или ждать на линии.
                  </p>
                </div>
              </GlassCard>

              <GlassCard className={`p-6 md:p-8 rounded-[2rem] flex gap-5 items-start relative overflow-hidden group transition-all duration-1000 ease-out transform ${comparisonVisible ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-8'}`} style={{ transitionDelay: '300ms' }}>
                <div className="w-12 h-12 rounded-full bg-blue-100/50 flex items-center justify-center shrink-0 border border-blue-200/50 group-hover:scale-110 transition-transform duration-500">
                  <BrainCircuit className="w-5 h-5 text-blue-500" />
                </div>
                <div>
                  <h4 className="text-lg font-medium mb-2 text-slate-800 tracking-wide">Естественный диалог</h4>
                  <p className="text-slate-600 font-light text-sm md:text-base leading-relaxed">
                    Нейро-сотрудник общается как живой человек, понимает собеседника и естественно отвечает на вопросы, <span className="font-medium text-slate-800">понимая логику диалога</span>.
                  </p>
                </div>
              </GlassCard>

              <GlassCard className={`p-6 md:p-8 rounded-[2rem] flex gap-5 items-start relative overflow-hidden group transition-all duration-1000 ease-out transform ${comparisonVisible ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-8'}`} style={{ transitionDelay: '500ms' }}>
                <div className="w-12 h-12 rounded-full bg-blue-100/50 flex items-center justify-center shrink-0 border border-blue-200/50 group-hover:scale-110 transition-transform duration-500">
                  <Network className="w-5 h-5 text-blue-500" />
                </div>
                <div>
                  <h4 className="text-lg font-medium mb-2 text-slate-800 tracking-wide">Автоматизация данных</h4>
                  <p className="text-slate-600 font-light text-sm md:text-base leading-relaxed">
                    Он не упустит ни одной детали и зафиксирует их, для передачи менеджеру компании через <span className="font-medium text-slate-800">автоматизированную инфраструктуру</span>.
                  </p>
                </div>
              </GlassCard>
            </div>

            {/* Infographic side - AUTONOMOUS ANIMATIONS */}
            {/* Убрали ref отсюда */}
            <div className="flex flex-col gap-8 w-full">
              
              {/* Human Bar */}
              <div className="flex flex-col gap-2">
                <span className={`text-xs uppercase tracking-widest text-slate-500 ml-2 transition-all duration-700 ease-out ${comparisonVisible ? 'opacity-100' : 'opacity-0'}`} style={{ transitionDelay: '100ms' }}>Живой оператор</span>
                <GlassCard className={`p-2 rounded-full flex gap-1 h-14 w-full transition-all duration-700 ease-out ${comparisonVisible ? 'opacity-100 bg-white/20' : 'opacity-0 bg-transparent border-transparent shadow-none'}`} style={{ transitionDelay: '200ms' }}>
                  <div className={`bg-blue-200/40 w-[15%] rounded-full flex items-center justify-center text-[10px] md:text-xs text-slate-600 backdrop-blur-sm transition-all duration-700 ease-out transform ${comparisonVisible ? 'opacity-100 translate-x-0 scale-100' : 'opacity-0 -translate-x-4 scale-95'}`} style={{ transitionDelay: '300ms' }}>Гудки</div>
                  <div className={`bg-blue-300/40 w-[40%] rounded-full flex items-center justify-center text-[10px] md:text-xs text-slate-600 backdrop-blur-sm text-center px-2 leading-tight transition-all duration-700 ease-out transform ${comparisonVisible ? 'opacity-100 translate-x-0 scale-100' : 'opacity-0 -translate-x-4 scale-95'}`} style={{ transitionDelay: '500ms' }}>«Сейчас все операторы заняты...»</div>
                  <div className={`bg-blue-400/40 flex-grow rounded-full flex items-center justify-center text-[10px] md:text-xs text-slate-700 font-medium backdrop-blur-sm transition-all duration-700 ease-out transform ${comparisonVisible ? 'opacity-100 translate-x-0 scale-100' : 'opacity-0 -translate-x-4 scale-95'}`} style={{ transitionDelay: '700ms' }}>Диалог</div>
                </GlassCard>
              </div>

              {/* Old Bot Bar */}
              <div className="flex flex-col gap-2">
                <span className={`text-xs uppercase tracking-widest text-slate-500 ml-2 transition-all duration-700 ease-out ${comparisonVisible ? 'opacity-100' : 'opacity-0'}`} style={{ transitionDelay: '300ms' }}>Старый автоответчик</span>
                <GlassCard className={`p-2 rounded-full flex gap-1 h-14 w-full transition-all duration-700 ease-out ${comparisonVisible ? 'opacity-100 bg-white/20' : 'opacity-0 bg-transparent border-transparent shadow-none'}`} style={{ transitionDelay: '400ms' }}>
                  <div className={`bg-blue-200/30 w-[10%] rounded-full flex items-center justify-center text-[10px] md:text-xs text-slate-600 backdrop-blur-sm transition-all duration-700 ease-out transform ${comparisonVisible ? 'opacity-100 translate-x-0 scale-100' : 'opacity-0 -translate-x-4 scale-95'}`} style={{ transitionDelay: '500ms' }}>Гудки</div>
                  <div className={`bg-blue-300/30 w-[25%] rounded-full flex items-center justify-center text-[10px] md:text-xs text-slate-600 backdrop-blur-sm text-center px-1 leading-tight transition-all duration-700 ease-out transform ${comparisonVisible ? 'opacity-100 translate-x-0 scale-100' : 'opacity-0 -translate-x-4 scale-95'}`} style={{ transitionDelay: '700ms' }}>Прослушать меню</div>
                  <div className={`bg-blue-400/30 w-[15%] rounded-full flex items-center justify-center text-[10px] md:text-xs text-slate-600 backdrop-blur-sm text-center px-1 leading-tight transition-all duration-700 ease-out transform ${comparisonVisible ? 'opacity-100 translate-x-0 scale-100' : 'opacity-0 -translate-x-4 scale-95'}`} style={{ transitionDelay: '900ms' }}>Нажать цифру</div>
                  <div className={`bg-blue-500/30 w-[20%] rounded-full flex items-center justify-center text-[10px] md:text-xs text-slate-600 backdrop-blur-sm text-center px-1 leading-tight transition-all duration-700 ease-out transform ${comparisonVisible ? 'opacity-100 translate-x-0 scale-100' : 'opacity-0 -translate-x-4 scale-95'}`} style={{ transitionDelay: '1100ms' }}>Ожидание</div>
                  <div className={`bg-blue-600/30 flex-grow rounded-full flex items-center justify-center text-[10px] md:text-xs text-slate-700 font-medium backdrop-blur-sm transition-all duration-700 ease-out transform ${comparisonVisible ? 'opacity-100 translate-x-0 scale-100' : 'opacity-0 -translate-x-4 scale-95'}`} style={{ transitionDelay: '1300ms' }}>Диалог</div>
                </GlassCard>
              </div>

              {/* VOCTA Bar */}
              <div className="flex flex-col gap-2 transform transition-transform hover:scale-[1.02] duration-300">
                <span className={`text-xs uppercase tracking-widest text-blue-500 font-medium ml-2 transition-all duration-700 ease-out ${comparisonVisible ? 'opacity-100' : 'opacity-0'}`} style={{ transitionDelay: '800ms' }}>VOCTA</span>
                <GlassCard className={`p-2 rounded-full flex gap-1 h-16 w-full border-teal-200/50 shadow-[0_0_30px_rgba(45,212,191,0.2)] transition-all duration-700 ease-out ${comparisonVisible ? 'opacity-100 bg-white/40' : 'opacity-0 bg-transparent shadow-none border-transparent'}`} style={{ transitionDelay: '900ms' }}>
                  <div className={`bg-gradient-to-r from-teal-200/60 to-emerald-300/60 w-full rounded-full flex items-center justify-center text-sm md:text-base text-teal-900 font-medium tracking-wide backdrop-blur-md transition-all duration-1000 ease-out transform ${comparisonVisible ? 'opacity-100 translate-x-0 scale-100' : 'opacity-0 -translate-x-10 scale-95'}`} style={{ transitionDelay: '1100ms' }}>
                    Мгновенное решение вопроса
                  </div>
                </GlassCard>
              </div>

            </div>
          </div>
        </section>

        {/* 4.5 ИИ ГЕНЕРАТОР СЦЕНАРИЕВ (Gemini Feature) */}
        <section className="w-full py-16 flex flex-col items-center">
          <GlassCard className="w-full max-w-4xl p-8 md:p-12 rounded-[2.5rem] bg-white/30 border-white/60 relative overflow-hidden">
            {/* Декоративный блеск */}
            <div className="absolute top-0 right-0 -mt-10 -mr-10 w-40 h-40 bg-blue-300/20 blur-[50px] rounded-full"></div>
            
            <div className="flex flex-col items-center text-center relative z-10">
              <Sparkles strokeWidth={1} className="w-10 h-10 text-blue-500 mb-4" />
              <h2 className="text-2xl md:text-3xl font-light mb-4 tracking-wide">Примерьте VOCTA на свой бизнес</h2>
              <p className="text-slate-600 font-light mb-8 max-w-2xl">
                Узнайте, как наш ИИ будет общаться именно с вашими клиентами. Введите сферу вашей деятельности, и нейросеть сгенерирует пример идеального диалога.
              </p>
              
              <div className="flex flex-col md:flex-row gap-4 w-full max-w-2xl mb-8">
                <input 
                  type="text" 
                  value={niche}
                  onChange={(e) => setNiche(e.target.value)}
                  placeholder="Например: Автосервис, Стоматология, Недвижимость..." 
                  className="flex-grow bg-white/40 border border-white/60 focus:border-blue-400 rounded-full px-6 py-4 outline-none backdrop-blur-md text-slate-800 placeholder-slate-500 font-light shadow-inner transition-colors"
                  onKeyDown={(e) => e.key === 'Enter' && handleGenerateScript()}
                />
                <GlassButton 
                  onClick={handleGenerateScript}
                  className="justify-center bg-blue-50/50 hover:bg-blue-100/50 border-blue-200/50"
                >
                  {isScriptLoading ? <Loader2 className="w-5 h-5 animate-spin" /> : "✨ Сгенерировать"}
                </GlassButton>
              </div>

              {generatedScript && (
                <div className="w-full max-w-3xl text-left bg-white/40 border border-white/50 p-6 md:p-8 rounded-3xl backdrop-blur-sm shadow-[0_4px_20px_rgba(0,0,0,0.02)] animate-in fade-in slide-in-from-bottom-4 duration-700">
                  <div className="text-xs uppercase tracking-widest text-blue-500 font-medium mb-4 flex items-center gap-2">
                    <CheckCircle2 className="w-4 h-4" /> Сценарий готов
                  </div>
                  <div className="space-y-4 text-slate-700 font-light leading-relaxed whitespace-pre-wrap">
                    {generatedScript}
                  </div>
                </div>
              )}
            </div>
          </GlassCard>
        </section>

        {/* 5. ANATOMY PUZZLE (Animated Digital Brain) */}
        <section id="section-2" ref={anatomyRef} className="w-full pt-8 pb-20 scroll-mt-16 flex flex-col items-center overflow-hidden">
          <h2 className="text-3xl md:text-4xl font-light text-center mb-16 tracking-wide">Из чего состоит ваш новый сотрудник</h2>
          
          <div className="relative w-full max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-8 items-center place-items-center">

            {/* Левая колонка компонентов */}
            <div className="flex flex-col gap-6 md:gap-16 w-full max-w-sm">
              <div className={`bg-white/30 backdrop-blur-xl border border-white/40 p-8 rounded-[2rem] flex flex-col items-center md:items-end md:text-right text-center gap-3 transition-all duration-1000 ease-out transform ${anatomyVisible ? 'opacity-100 translate-x-0' : 'opacity-0 md:translate-x-12 translate-y-12 md:translate-y-0'}`} style={{ transitionDelay: '100ms' }}>
                <Activity strokeWidth={1.5} className="w-10 h-10 text-blue-500" />
                <h3 className="text-xl font-medium tracking-widest uppercase text-slate-800">VOCTA Voice</h3>
                <p className="text-slate-600 font-light text-sm">Понимает речь клиента</p>
              </div>

              <div className={`bg-white/30 backdrop-blur-xl border border-white/40 p-8 rounded-[2rem] flex flex-col items-center md:items-end md:text-right text-center gap-3 transition-all duration-1000 ease-out transform ${anatomyVisible ? 'opacity-100 translate-x-0' : 'opacity-0 md:translate-x-12 translate-y-12 md:translate-y-0'}`} style={{ transitionDelay: '300ms' }}>
                <Network strokeWidth={1.5} className="w-10 h-10 text-blue-500" />
                <h3 className="text-xl font-medium tracking-widest uppercase text-slate-800">VOCTA API</h3>
                <p className="text-slate-600 font-light text-sm">Отвечает за автоматизацию получения готовых ЛИДов</p>
              </div>
            </div>

            {/* Центральный мозг ИИ */}
            <div className={`order-first md:order-none relative flex items-center justify-center w-48 h-48 md:w-64 md:h-64 transition-all duration-1000 ease-out transform ${anatomyVisible ? 'opacity-100 scale-100' : 'opacity-0 scale-75'}`} style={{ transitionDelay: '500ms' }}>
                {/* Соединительные линии (видны на десктопе) */}
                <div className="absolute top-1/2 left-[-30%] right-[-30%] h-[1px] bg-gradient-to-r from-transparent via-blue-300/60 to-transparent hidden md:block -z-10"></div>
                <div className="absolute left-1/2 top-[-30%] bottom-[-30%] w-[1px] bg-gradient-to-b from-transparent via-blue-300/60 to-transparent hidden md:block -z-10"></div>

                {/* Вращающиеся кольца ядра */}
                <div className="absolute inset-4 rounded-full border border-blue-400/30 border-dashed animate-[spin_20s_linear_infinite]"></div>
                <div className="absolute inset-8 rounded-full border border-blue-300/40 animate-[spin_15s_linear_infinite_reverse]"></div>
                
                {/* Пульсирующая сердцевина */}
                <div className="absolute inset-12 rounded-full bg-gradient-to-tr from-blue-300/30 to-white/40 backdrop-blur-md shadow-[0_0_80px_rgba(59,130,246,0.5)] animate-pulse"></div>
                
                {/* Иконка мозга */}
                <BrainCircuit className="w-20 h-20 md:w-24 md:h-24 text-blue-500 relative z-10 drop-shadow-[0_0_15px_rgba(59,130,246,0.6)]" strokeWidth={1} />
            </div>

            {/* Правая колонка компонентов */}
            <div className="flex flex-col gap-6 md:gap-16 w-full max-w-sm">
              <div className={`bg-white/30 backdrop-blur-xl border border-white/40 p-8 rounded-[2rem] flex flex-col items-center md:items-start md:text-left text-center gap-3 transition-all duration-1000 ease-out transform ${anatomyVisible ? 'opacity-100 translate-x-0' : 'opacity-0 md:-translate-x-12 translate-y-12 md:translate-y-0'}`} style={{ transitionDelay: '700ms' }}>
                <BrainCircuit strokeWidth={1.5} className="w-10 h-10 text-blue-500" />
                <h3 className="text-xl font-medium tracking-widest uppercase text-slate-800">VOCTA Think</h3>
                <p className="text-slate-600 font-light text-sm">Думает как лучше ответить клиенту</p>
              </div>

              <div className={`bg-white/30 backdrop-blur-xl border border-white/40 p-8 rounded-[2rem] flex flex-col items-center md:items-start md:text-left text-center gap-3 transition-all duration-1000 ease-out transform ${anatomyVisible ? 'opacity-100 translate-x-0' : 'opacity-0 md:-translate-x-12 translate-y-12 md:translate-y-0'}`} style={{ transitionDelay: '900ms' }}>
                <ShieldCheck strokeWidth={1.5} className="w-10 h-10 text-blue-500" />
                <h3 className="text-xl font-medium tracking-widest uppercase text-slate-800">VOCTA Secure</h3>
                <p className="text-slate-600 font-light text-sm">Обеспечивает безопасность вашего бюджета</p>
              </div>
            </div>

          </div>
        </section>

        {/* 6. LAUNCH TIMELINE */}
        <section id="section-3" className="w-full pt-8 pb-20 scroll-mt-16">
          <h2 className="text-3xl md:text-4xl font-light text-center mb-20 tracking-wide">Процесс запуска</h2>
          
          <div className="relative max-w-4xl mx-auto">
            {/* Central Line */}
            <div className="absolute left-[28px] md:left-1/2 top-0 bottom-0 w-[1px] bg-gradient-to-b from-blue-200 via-blue-300 to-transparent transform md:-translate-x-1/2"></div>
            
            {[
              {
                title: "Ваша задача",
                desc: "Проведем встречу, где обсудим задачу, которую должен выполнять ваш нейро-сотрудник."
              },
              {
                title: "Решение задачи",
                desc: "Используя опыт более 14-ти лет продаж в банковской сфере, предложим вариант диалога для вашего нейро-сотрудника для решения бизнес задачи."
              },
              {
                title: "Обучение",
                desc: "Обучим нейро-сотрудника общаться с клиентом, для решения бизнес задачи: отвечать на вопросы, предлагать товар или услугу, отрабатывать возражения, собирать данные клиентов и передавать их Вам."
              },
              {
                title: "Тестирование",
                desc: "Проведем тестирование в «полевых условиях», чтобы ваш сотрудник эффективно выполнял свою задачу."
              },
              {
                title: "Запуск",
                desc: "После успешного прохождения тестирования, мы запускаем вашего нейро-сотрудника и настраиваем автоматизированную инфраструктуру, чтобы вы получали готовых к продаже клиентов."
              },
              {
                title: "Развитие",
                desc: "Будем следить, чтобы ваш сотрудник непрерывно развивался, повышая свою эффективность."
              }
            ].map((step, idx) => (
              <div key={idx} className={`relative flex items-start mb-12 last:mb-0 ${idx % 2 === 0 ? 'md:flex-row' : 'md:flex-row-reverse'}`}>
                
                {/* Dot */}
                <div className="absolute left-[28px] md:left-1/2 transform -translate-x-1/2 w-4 h-4 rounded-full bg-white border-2 border-blue-300 shadow-[0_0_10px_rgba(147,197,253,0.8)] z-10 mt-6"></div>
                
                {/* Content Card Wrapper */}
                <div className={`ml-16 md:ml-0 w-full md:w-1/2 ${idx % 2 === 0 ? 'md:pr-16 text-left md:text-right' : 'md:pl-16 text-left'}`}>
                  <GlassCard className="p-8 rounded-[2rem] inline-block w-full hover:scale-[1.02] transition-transform duration-300">
                    <div className="text-sm font-medium tracking-widest text-blue-400 mb-2 uppercase">Этап 0{idx + 1}</div>
                    <h3 className="text-xl font-medium tracking-wide mb-3">{step.title}</h3>
                    <p className="text-slate-600 font-light leading-relaxed text-sm md:text-base">{step.desc}</p>
                  </GlassCard>
                </div>
              </div>
            ))}
          </div>
        </section>

        {/* 7. BENEFITS */}
        <section id="section-4" className="w-full pt-8 pb-20 scroll-mt-16 max-w-4xl mx-auto">
          <GlassCard className="p-10 md:p-16 rounded-[3rem] border-white/70 bg-white/30">
            <h2 className="text-3xl md:text-4xl font-light text-center mb-12 tracking-wide">Почему нейро-сотрудник вам нужен</h2>
            
            <ul className="space-y-6">
              {[
                "Сокращает ожидание клиента на 98% по сравнению с оператором и автоответчиком.",
                "Вопрос клиента решается быстрее, потому что нейро-сотрудник реагирует в диалоге быстрее человека.",
                "Минимизирует раздражение клиента из-за прослушивания автоответчика.",
                "Позволяет вашей компании оставаться на связи 24/7.",
                "Сокращает количество ошибок, которые возникают по вине человека."
              ].map((benefit, idx) => (
                <li key={idx} className="flex items-start gap-4">
                  <div className="mt-1 flex-shrink-0 w-6 h-6 rounded-full bg-blue-100/50 flex items-center justify-center border border-blue-200/50 backdrop-blur-sm">
                    <ChevronRight strokeWidth={2} className="w-3 h-3 text-blue-500" />
                  </div>
                  <p className="text-lg text-slate-700 font-light leading-relaxed">{benefit}</p>
                </li>
              ))}
            </ul>
          </GlassCard>
        </section>

        {/* 8. CALL TO ACTION */}
        <section className="w-full py-20 flex justify-center text-center">
          <GlassButton 
            className="text-base md:text-lg px-10 py-5 rounded-[2.5rem] bg-white/40 border-white/80 hover:bg-white/60 hover:shadow-[0_8px_30px_rgba(0,0,0,0.08)] scale-100 hover:scale-105"
            onClick={() => alert("Форма захвата лидов будет открыта здесь")}
          >
            Нанять своего лучшего сотрудника
          </GlassButton>
        </section>

      </main>

      {/* Minimal Footer */}
      <footer className="w-full py-8 border-t border-white/30 backdrop-blur-md bg-white/10 text-center relative z-20">
        <p className="text-xs tracking-widest text-slate-500 font-light">© {new Date().getFullYear()} VOCTA. ALL RIGHTS RESERVED.</p>
      </footer>

      {/* Scroll to Top Button */}
      <button
        onClick={scrollToTop}
        className={`fixed bottom-8 right-8 z-50 p-3 rounded-full bg-white/30 backdrop-blur-xl border border-white/60 shadow-[0_4px_20px_rgba(0,0,0,0.1)] text-slate-700 hover:text-blue-500 hover:bg-white/50 transition-all duration-500 transform ${
          showScrollTop ? 'translate-y-0 opacity-100' : 'translate-y-16 opacity-0 pointer-events-none'
        }`}
        aria-label="Наверх"
      >
        <ChevronUp className="w-6 h-6" />
      </button>

    </div>
  );
};

export default App;
